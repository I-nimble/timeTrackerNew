<main class="h-100 d-flex flex-column justify-content-center">
  <div class="rounded shadow text-center card max-h-75 mt-5">
    <div
      class="card-header d-flex justify-content-between justify-content-sm-between align-items-center"
    >
      <h1 class="mb-0 text-dark fs-3">{{ title }}</h1>
      <button
        mat-button
        class="hidden-sm d-sm-none border"
        (click)="resetForm(); onMobileCloseForm.emit(false)"
      >
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    <div class="card-body position-relative i-flow">
      <form
        action=""
        class="p-1 mb-2"
        [formGroup]="userForm"
        (ngSubmit)="submitUserForm()"
      >
        <section class="mb-3">
          <div class="profile-img mb-3 mx-auto bg-accent">
            <img [src]="img ? img : assetsPath" alt="" />
            <div 
              class="file btn btn-lg btn-primary opacity-75 cursor-pointer"
            >
              Change Photo
              <input
                type="file"
                name="profile"
                (change)="onFileSelected($event)"
                accept="image/jpeg, image/jpg, image/png"
              />
            </div>
          </div>
          <div class="form-group row justify-content-between">
            <div class="col-12 col-md-6 mb-3">
              <input
                type="text"
                formControlName="name"
                class="form-control p-2"
                placeholder="Name"
              />
            </div>
            <div class="col-12 col-md-6 mb-3">
              <input
                type="text"
                formControlName="last_name"
                class="form-control p-2"
                placeholder="Last Name"
              />
            </div>
          </div>
          <div class="form-group mb-3">
            <input
              type="email"
              class="form-control p-2"
              formControlName="email"
              placeholder="Email Address"
            />
          </div>
          <div class="form-group mb-3">
            <input
              type="password"
              class="form-control p-2 mb-3"
              formControlName="password"
              (change)="handlePasswordValidity()"
              placeholder="Password"
            />
            <input
              type="password"
              class="form-control p-2 mb-3"
              formControlName="cpassword"
              placeholder="Confirm Password"
            />
          </div>
          <div class="form-group mb-3">
            <select
              class="form-select p-2"
              formControlName="role"
              name="role_select"
              id=""
            >
              <option value="" disabled>Select a Role</option>
              <option value="{{ role.id }}" *ngFor="let role of roleList">
                {{ role.name }}
              </option>
            </select>
          </div>
          <div
            class="form-group"
            formGroupName="employee"
            *ngIf="userForm.get('role')!.value == EMPLOYEE_ROLE"
          >
            <select
              name="employee"
              formControlName="id"
              id=""
              class="form-select p-2 mb-3"
            >
              <option value="" disabled>Select a company</option>
              <option
                value="{{ company.id }}"
                *ngFor="let company of companies"
              >
                {{ company.name }}
              </option>
            </select>
            <select
              name="position"
              formControlName="position"
              class="form-select p-2 mb-3"
            >
              <option value="" disabled>Select a position</option>
              <option [value]="position.id" *ngFor="let position of positions">
                {{ position.title }}
              </option>
            </select>
            <input
              type="number"
              name="Hourly rate"
              formControlName="hourly_rate"
              class="form-control p-2 mb-3"
              placeholder="Hourly rate"
            />

            <!-- schedules section -->
            <div class="border rounded-1 text-start card">
              <div
                class="card-header p-1 px-3 d-flex align-items-center justify-content-between"
              >
                <h2 class="fs-5 mb-0">Schedules</h2>
                <a
                  [disabled]="checkSelectedDays()"
                  mat-button
                  color="primary"
                  class="btn btn-primary btn-block btn-hover transition p-1"
                  (click)="openFormModal('schedule')"
                  ><i class="fa-solid fa-plus"></i
                ></a>
              </div>
              <div class="card-body p-0">
                <ng-container
                  *ngIf="
                    userForm.get('employee')?.get('schedule')?.value != null
                  "
                >
                  <div
                    class="border-bottom"
                    *ngFor="
                      let schedule of userForm.get('employee')?.get('schedule')
                        ?.value;
                      let i = index
                    "
                  >
                    <div class="p-2">
                      <div
                        class="d-flex align-items-center px-2"
                        *ngFor="let day of schedule.days"
                      >
                        <h3 class="fs-6 mb-0">
                          <i class="fa-regular fa-calendar-days"></i>:
                          {{ day.name }}
                        </h3>
                        <a
                          mat-icon-button
                          class="ms-2"
                          (click)="removeDayFromSchedule(day, i)"
                        >
                          <mat-icon>close</mat-icon>
                        </a>
                      </div>
                    </div>

                    <div
                      class="d-flex justify-content-between align-items-center border-top p-2"
                    >
                      <section class="d-flex flex-wrap gap-2">
                        <p class="mb-0">
                          From: {{ displayScheduleTimes(schedule.start_time) }}
                        </p>
                        <p class="mb-0">
                          To: {{ displayScheduleTimes(schedule.end_time) }}
                        </p>
                      </section>
                      <app-more-vert
                        [options]="scheduleOptions"
                        [itemId]="i.toString()"
                        (onSelectedItem)="selectItem($event)"
                      ></app-more-vert>
                    </div>
                  </div>
                </ng-container>
                <ng-container
                  *ngIf="
                    !userForm.get('employee')?.get('schedule')?.value ||
                    userForm.get('employee')?.get('schedule')?.value.length == 0
                  "
                >
                  <p class="text-center my-2">
                    no schedule specified
                  </p></ng-container
                >
              </div>
            </div>
          </div>
          <div
            class="form-group"
            formGroupName="company"
            *ngIf="userForm.get('role')!.value == EMPLOYER_ROLE"
          >
            <div class="d-flex align-items-center mb-3 gap-2">
              <select
                name="name"
                formControlName="id"
                id=""
                class="form-select p-2"
                (change)="setUserCompany($event.target)"
              >
                <option value="" disabled>Select a company</option>
                <option
                  value="{{ company.id }}"
                  *ngFor="let company of companies"
                >
                  {{ company.name }}
                </option>
              </select>
              <a
                mat-button
                class="col border"
                (click)="openFormModal('company')"
              >
                <i class="fa-solid fa-plus"></i>
              </a>
            </div>
          </div>
        </section>
        <div
          class="d-flex position-relative justify-content-between align-items-center"
        >
          <app-loader [loader]="loader" [message]="message"></app-loader>
          <div>
            <a
              color="warn"
              mat-raised-button
              class="btn btn-block rounded px-4"
              (click)="deleteUser(selectedUser.id)"
              *ngIf="selectedUser"
            >
              Delete
            </a>
            <button
              color="primary"
              mat-raised-button
              class="btn btn-primary btn-block btn-hover transition rounded px-4 ms-2"
            >
              Save
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</main>
