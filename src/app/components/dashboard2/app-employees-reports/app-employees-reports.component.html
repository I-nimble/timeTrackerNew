<mat-card class="cardWithShadow h-100">
  <mat-card-header>
    <div class="filters-row row w-100">
      <div class="col-md-5 mb-2">
        <div *ngIf="role == '1' || allowedTM">
          <mat-form-field class="w-100" appearance="outline">
            <mat-label>Select a Company</mat-label>
            <mat-select
              [(value)]="selectedClient"
              (selectionChange)="onClientChange($event.value)"
            >
              <mat-option [value]="null" disabled>Select a client</mat-option>
              <mat-option *ngFor="let company of companiesList" [value]="company.id">
                {{ company.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div *ngIf="role == '3'" style="display:none"></div>
        <mat-form-field class="w-100" appearance="outline">
          <mat-label>Select a Team Member</mat-label>
          <mat-select
            [(value)]="selectedUserId"
            (selectionChange)="onUserChange($event.value)"
            [disabled]="!selectedClient && (role == '1' || allowedTM)"
          >
            <mat-option [value]="null">All members</mat-option>
            <mat-option
              *ngFor="let user of dataSource"
              [value]="user.profile.id"
            >
              {{ user.profile.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-12 col-md-6">
        <mat-form-field class="w-100" appearance="outline">
          <mat-label>Date Range</mat-label>
          <mat-date-range-input [rangePicker]="picker">
            <input
              matStartDate
              placeholder="Start date"
              [(ngModel)]="startDate"
              (dateChange)="onDateRangeChange()"
            />
            <input
              matEndDate
              placeholder="End date"
              [(ngModel)]="endDate"
              (dateChange)="onDateRangeChange()"
            />
          </mat-date-range-input>
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-date-range-picker #picker></mat-date-range-picker>
        </mat-form-field>
      </div>
      <div 
        class="col-12 col-md-1 d-flex justify-content-center justify-content-md-start mt-2 mt-md-0"
      >
        <button
          *ngIf="role != '2' || allowedTM"
          mat-flat-button
          (click)="downloadReportAll()"
          [disabled]="isLoading || !dataSource?.length"
          title="Download All Reports"
        >
          <i-tabler name="download" class="icon-18 me-1"></i-tabler>
        </button>
      </div>
    </div>
  </mat-card-header>
  <mat-card-content class="p-t-0">
    <div class="table-responsive">
      <ng-container *ngIf="isLoading; else afterLoad">
        <div class="text-center p-4">
          <mat-progress-spinner diameter="70" mode="indeterminate"></mat-progress-spinner>
        </div>
      </ng-container>
      <ng-template #afterLoad>
        <div *ngIf="(role == '1' || allowedTM) && (!selectedClient || selectedClient === 0); else showResults">
          <div class="text-center p-4 f-s-16 text-muted">
            Please select a company.
          </div>
        </div>
        <ng-template #showResults>
          <app-employee-table
            *ngIf="dataSource.length > 0; else noData"
            [displayedColumns]="customColumns"
            [dataSource]="filteredDataSource">
          </app-employee-table>
          <ng-template #noData>
            <div class="text-center p-4 f-s-16 text-muted">
              No completed tasks yet.
            </div>
          </ng-template>
        </ng-template>
      </ng-template>
    </div>
  </mat-card-content>
</mat-card>
