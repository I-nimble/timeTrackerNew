<mat-card class="cardWithShadow mb-3">
  <mat-card-content class="d-flex justify-content-between align-items-center">
    <span class="f-w-600 f-s-16">Notifications</span>
    <button mat-flat-button color="primary" (click)="markAsRead(notificationsDataSource.data)" class="f-s-14">
      Mark all as read
    </button>
  </mat-card-content>
</mat-card>

<mat-card class="cardWithShadow">
  <mat-card-content class="p-t-0">
    <div class="table-responsive">
      <table mat-table [dataSource]="notificationsDataSource" class="w-100 mat-elevation-z8 demo-table">

        <!-- Desktop columns -->
        <ng-container class="mat-column-message desktop-only" matColumnDef="message">
          <th mat-header-cell *matHeaderCellDef class="f-w-600 f-s-16" style="width: 40%">Message</th>
          <td mat-cell *matCellDef="let notification" style="width: 40%">
            <div class="d-flex align-items-start gap-2">
              <i [ngClass]="notificationIcons[notification.type_id - 1].icon" 
                 [ngStyle]="{
                   'color': notification.users_notifications.status === 2 
                     ? '#727272' 
                     : notificationIcons[notification.type_id - 1].color
                 }">
              </i>
              <span 
                class="text-truncate-3-lines"
                [class.read-notification]="notification.users_notifications.status === 2"
                [innerHTML]="formatMessage(notification.message)">
              </span>
            </div>
          </td>
        </ng-container>

        <ng-container class="mat-column-date desktop-only" matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef class="f-w-600 f-s-16">Date</th>
          <td mat-cell *matCellDef="let notification" class="d-flex justify-content-between align-items-center">
            <span [class.read-notification]="notification.users_notifications.status === 2">
              {{ notification.createdAt | date: 'MMM d, y' }}
            </span>
            <button *ngIf="notification.users_notifications.status !== 2" 
                    (click)="markAsRead([notification])" 
                    mat-button>
              Mark as read
            </button>
          </td>
        </ng-container>

        <!-- Mobile column -->
        <ng-container class="mobile-only" matColumnDef="mobile">
          <th mat-header-cell *matHeaderCellDef class="f-w-600 f-s-16">Notification</th>
          <td mat-cell *matCellDef="let notification">
            <div class="d-flex align-items-start gap-2">
              <i [ngClass]="notificationIcons[notification.type_id - 1].icon" 
                 [ngStyle]="{
                   'color': notification.users_notifications.status === 2 
                     ? '#727272' 
                     : notificationIcons[notification.type_id - 1].color
                 }">
              </i>
              <div>
                <span 
                  class="text-truncate-3-lines"
                  [class.read-notification]="notification.users_notifications.status === 2"
                  [innerHTML]="formatMessage(notification.message)">
                </span>
                <div class="f-s-13 text-muted mt-1" [class.read-notification]="notification.users_notifications.status === 2">
                  {{ notification.createdAt | date: 'MMM d, y' }}
                </div>
                <button *ngIf="notification.users_notifications.status !== 2" 
                        (click)="markAsRead([notification])" 
                        mat-button
                        class="mt-1 m-l-0">
                  Mark as read
                </button>
              </div>
            </div>
          </td>
        </ng-container>

        <tr mat-row
            *matRowDef="let row; columns: displayedColumns; when: isDesktopRow"
            (click)="handleClick(row)"
            class="desktop-only"></tr>
        <tr mat-row
            *matRowDef="let row; columns: ['mobile']; when: isMobileRow"
            (click)="handleClick(row)"
            class="mobile-only"></tr>
    </table>

      <mat-paginator
        [length]="notificationsDataSource.data.length"
        [pageSize]="10"
        [pageSizeOptions]="[10, 20, 50]">
      </mat-paginator>

      <div *ngIf="notificationsDataSource.data.length === 0" class="text-center p-4 f-s-16 text-muted">
        There are no notifications yet.
      </div>

      <div *ngIf="!loaded" class="d-flex justify-content-center p-4">
        <mat-spinner></mat-spinner>
      </div>
    </div>
  </mat-card-content>
</mat-card>