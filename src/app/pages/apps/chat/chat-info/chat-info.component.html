<mat-dialog-content class="mat-typography p-24">
  <div class="dialog-header d-flex align-center justify-between mb-24">
    <h2 class="dialog-title f-w-600 m-0">
      {{ data.conversation?.t === 'd' ? 'Contact Info' : 
         data.conversation?.t === 'c' ? 'Group Info' : 
         data.conversation?.t === 'p' ? 'Team Info' : 'Info' }}
    </h2>
    <button mat-icon-button (click)="dialogRef.close()" class="close-btn">
      <mat-icon>close</mat-icon>
    </button>
  </div>
  <div class="info-avatar-wrapper text-center mb-24">
    <img
      *ngIf="roomPicture; else defaultGroupPicture"
      [src]="roomPicture"
      class="info-avatar"
      alt="avatar"
    />
    <ng-template #defaultGroupPicture>
      <img src="assets/images/group-icon.webp" class="info-avatar" alt="group" />
    </ng-template>
  </div>
  <ng-container *ngIf="data.conversation?.t === 'd' && data.userInfo">
    <div class="info-block">
      <span class="field-label">Username</span>
      <span class="field-value">{{ data.userInfo.username }}</span>
    </div>
    <div class="info-block" *ngIf="data.userInfo.email">
      <span class="field-label">Email</span>
      <span class="field-value">{{ data.userInfo.email }}</span>
    </div>
    <div class="info-block" *ngIf="data.userInfo.utcOffset !== undefined">
      <span class="field-label">Local time</span>
      <span class="field-value">{{ getLocalTime(data.userInfo.utcOffset) }}</span>
    </div>
    <div class="info-block" *ngIf="data.userInfo.lastLogin">
      <span class="field-label">Last login</span>
      <span class="field-value">{{ data.userInfo.lastLogin | date:'HH:mm' }}</span>
    </div>
    <div class="info-block" *ngIf="data.userInfo.createdAt">
      <span class="field-label">Created at</span>
      <span class="field-value">{{ data.userInfo.createdAt | date:'MMM d, yyyy' }}</span>
    </div>
  </ng-container>
  <ng-container *ngIf="(data.conversation?.t === 'c' || data.conversation?.t === 'p') && data.channelMembers?.length">
    <div class="members-header d-flex align-center gap-8">
      <button
        mat-icon-button
        *ngIf="canManageRoom"
        (click)="toggleAddMembers()"
      >
        <mat-icon>
          {{ showAddMembers ? 'arrow_back' : 'person_add' }}
        </mat-icon>
      </button>
      <h4 class="members-title m-0">
        {{ showAddMembers ? 'Add members' : 'Members (' + data.channelMembers.length + ')' }}
      </h4>
    </div>
    <div *ngIf="!showAddMembers" class="m-t-12">
      <div
        *ngFor="let m of data.channelMembers"
        class="member-row d-flex align-center gap-12 mb-16"
      >
        <img [src]="m.avatarUrl" width="48" class="rounded-circle" />
        <div>{{ m.username }}</div>
        <span class="flex-spacer"></span>
        <button
          mat-icon-button
          [matMenuTriggerFor]="memberMenu"
          *ngIf="canManageMembers(m)"
        >
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #memberMenu="matMenu">
          <button mat-menu-item (click)="removeMember(m)">
            <mat-icon color="warn">person_remove</mat-icon>
            <span>Remove from group</span>
          </button>
        </mat-menu>
      </div>
      <button
        mat-raised-button
        color="primary"
        class="mt-16 w-100"
        *ngIf="canManageRoom"
        (click)="deleteRoom()"
      >
        Delete group
      </button>
    </div>
    <div *ngIf="showAddMembers" class="full-member-selector mt-8">
      <mat-selection-list [(ngModel)]="selectedUsers">
        <mat-list-option
          *ngFor="let u of availableUsers"
          [value]="u"
          [disabled]="isAlreadyMember(u)"
        >
          <div class="member-row d-flex align-center gap-12">
            <img
              [src]="getUserAvatar(u)"
              width="30"
              class="rounded-circle"
              alt="avatar"
            />
            <div>{{ u.username }}</div>
          </div>
        </mat-list-option>
      </mat-selection-list>
      <button
        mat-raised-button
        color="primary"
        class="mt-16 w-100"
        [disabled]="!selectedUsers.length"
        (click)="addMembers()"
      >
        Add Selected
      </button>
    </div>
  </ng-container>
</mat-dialog-content>