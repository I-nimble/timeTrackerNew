<mat-card class="mat-mdc-card mdc-card chat-app cardWithShadow overflow-hidden">
  <mat-sidenav-container class="mat-drawer-container mat-sidenav-container mat-drawer-transition side-panel-opened chat-container">
    <mat-sidenav #sidebar
      class="mat-drawer mat-sidenav bg-white mat-drawer-side mat-drawer-opened chat-sidebar"
      [mode]="'side'"
      [opened]="!isMobile || isSidebarOpen"
    >
      <div class="mat-drawer-inner-container chat-sidebar-inner">
        <div class="sidebar-header">
          <img [src]="chatService.loggedInUser?.avatarUrl || defaultAvatarUrl" alt="owner" />
          <div class="sidebar-user-info">
            <h4>{{ chatService.loggedInUser?.name }}</h4>
            <span>
               {{ getUserEmail() }}
            </span>
          </div>
        </div>

        <div class="sidebar-search">
          <mat-form-field appearance="outline" class="w-100">
            <input
              matInput
              placeholder="Search conversations"
              [(ngModel)]="roomsFilter"
            />
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>
        </div>

        <div class="contacts-wrapper">
          <div
            class="contact-item"
            *ngFor="let room of filteredRooms()"
            [class.active]="selectedConversation?._id === room._id"
            (click)="selectRoom(room)"
          >
            <img [src]="getConversationPicture(room)">
            <div class="contact-info">
              <div class="name">
                {{ getConversationName(room) }}
              </div>
              <div class="last-message">
                {{ getLastMessage(room) }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </mat-sidenav>

    <mat-sidenav-content
      class="mat-drawer-content mat-sidenav-content bg-white chat-main"
      (click)="isMobile && isSidebarOpen ? sidebar.close() : null"   
      [style.margin-left.px]="!isMobile && isSidebarOpen ? 320 : 0"
    >
      <mat-toolbar class="mat-toolbar chat-right-panel d-flex align-items-center justify-content-between bg-white b-b-1 gap-8 mat-toolbar-single-row chat-toolbar">
        <div class="d-flex">
          <button mat-icon-button
                  (click)="toggleSidebar(); sidebar.toggle()"
                  class="mdc-icon-button mat-mdc-icon-button mat-mdc-button-base mat-unthemed">
            <mat-icon>short_text</mat-icon>
          </button>
          <div class="d-flex align-items-center gap-16">
            <img *ngIf="selectedConversation" [src]="getConversationPicture(selectedConversation)" width="40" class="rounded-circle" alt="contact" />
            <div class="f-s-16 f-w-600">
              {{ selectedConversation ? getConversationName(selectedConversation) : 'Select a conversation' }}
            </div>
          </div>
        </div>
        <div *ngIf="selectedConversation">
          <button mat-icon-button class="m-l-auto" aria-label="Call" disabled>
            <mat-icon>call</mat-icon>
          </button>
          <button mat-icon-button (click)="call()" class="m-l-auto" aria-label="Video call">
            <mat-icon>video_call</mat-icon>
          </button>
          <button mat-icon-button [matMenuTriggerFor]="chatMenu" class="m-l-auto">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #chatMenu="matMenu">
            <button mat-menu-item disabled>Contact info</button>
            <button mat-menu-item disabled>Mute</button>
            <button mat-menu-item disabled>Delete Chat</button>
          </mat-menu>
        </div>
      </mat-toolbar>

      <div class="chat-messages-wrapper">
        <mat-card-content class="mat-mdc-card-content chat-middle-box p-24 bg-white chat-messages" #messagesContainer>
          <ng-container *ngIf="selectedConversation; else noConversation">
            <div *ngFor="let message of messages" class="chat-list"
                [ngClass]="message.u._id === chatService.loggedInUser?._id ? 'odd' : 'even'">
              <div class="m-b-15">
                <div [ngClass]="message.t === 'odd' ? 'bg-light-primary p-10 rounded d-flex align-items-center gap-16' : 'bg-light-secondary p-10 rounded d-flex align-items-center f-s-14 message-out'">
                  <img *ngIf="message.t === 'odd'" width="40" class="rounded-circle" [src]="getConversationPicture(selectedConversation)" />
                  <span class="f-s-14">
                    {{ message.msg }}
                  </span>
                </div>
                <span class="f-s-12">{{ message.ts | date:'MMM d, yyyy' }}</span>
              </div>
            </div>
          </ng-container>
          <ng-template #noConversation>
            <div class="empty-cta p-24 text-center">Select a contact on the left to view conversation</div>
          </ng-template>
        </mat-card-content>
      </div>

      <mat-divider></mat-divider>
      <div class="p-t-20 p-x-24 bg-white chat-input">
        <mat-form-field appearance="outline" class="mat-mdc-form-field w-100">
          <input matInput placeholder="Send message" [(ngModel)]="newMessage" (keyup.enter)="sendMessage()" />
          <button mat-icon-button matSuffix (click)="sendMessage()">
            <mat-icon>send</mat-icon>
          </button>
        </mat-form-field>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>
</mat-card>