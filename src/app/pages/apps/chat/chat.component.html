<mat-card class="mat-card-top cardWithShadow communication-container">
  <ng-template #customMenu>
    <div style="display: flex; gap: 12px; margin-right: 5px;">
      <button [ngStyle]="getButtonStyle()" (click)="startVoiceCall()">
        <img src="assets/images/svgs/Audio-Call2x.svg" [ngStyle]="getButtonIconStyle()" alt="Voice Call" />
      </button>
      <button [ngStyle]="getButtonStyle()" (click)="startVideoCall()">
        <img src="assets/images/svgs/Video-call2x.svg" [ngStyle]="getButtonIconStyle()" alt="Video Call" />
      </button>
    </div>
  </ng-template>

  <ng-template #customMessageComposerView>
    <app-custom-message-composer
      [user]="user"
      [group]="group"
    ></app-custom-message-composer>
  </ng-template>

  <app-loader *ngIf="loader.started && !loader.complete && !loader.error" [loader]="loader" style="margin: 0 auto;">
  </app-loader>

  <ng-container *ngIf="loader.complete">
    @if(chatService.isChatAvailable && !chatInitError) {
    <div class="d-flex justify-content-start align-items-center m-b-16 m-t-16">
      <div *ngIf="userRole === '1' || userRole === '4'">
        <mat-form-field appearance="outline" class="w-100 company-select">
          <mat-select [(value)]="selectedCompanyId" (change)="initializeCompanyChat()">
            <mat-option *ngFor="let company of companies" [value]="company.id">
              {{ company.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <button mat-flat-button color="primary" *ngIf="userRole !== '2' || (userId && groupCreatorUserIds.includes(userId))"
        (click)="openDialog()" id="create-group-button">
        Create Group
      </button>
    </div>

      <!-- BASIC PLAN CHAT -->
      <cometchat-groups-with-messages 
        *ngIf="plan && plan.id == 1"
        id="chat-container"
        [backdropStyle]="backdropStyle"
        [hideCreateGroup]="true"
        [messagesConfiguration]="basicMessagesConfig"
        [StartConversationConfiguration]="StartConversationConfiguration"
        [groupsConfiguration]="groupsConfiguration"
        [user]="user"
        [group]="group"
      >
      </cometchat-groups-with-messages>
    
      <!-- ESSENTIAL PLAN CHAT -->
      <cometchat-conversations-with-messages 
        *ngIf="plan && plan.id === 2"
        id="chat-container"
        [messagesConfiguration]="essentialMessagesConfig"
        [StartConversationConfiguration]="StartConversationConfiguration"
        [conversationConfiguration]="conversationConfiguration"
        [user]="user"
        [group]="group"
      >
      </cometchat-conversations-with-messages>

      <!-- PROFESSIONAL PLAN CHAT -->
      <cometchat-conversations-with-messages 
        *ngIf="(plan && plan.id === 3) || (userRole === '1' || userRole === '4')"
        id="chat-container"
        [messagesConfiguration]="professionalMessagesConfig"
        [StartConversationConfiguration]="StartConversationConfiguration"
        [conversationConfiguration]="conversationConfiguration"
        [user]="user"
        [group]="group"
      >
      </cometchat-conversations-with-messages>
    }
    @else if (loader.complete && chatInitError) {
    <div class="cta-message">
      <p>{{ chatInitError }}</p>
    </div>
    }
    @else if (loader.complete && !chatService.isChatAvailable && !chatInitError) {
      <div class="cta-message">
        <p>Your chat is not available. Communicate with support to enable it.</p>
      </div>
    }
  </ng-container>
</mat-card>