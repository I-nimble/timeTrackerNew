<div class="row">
  <div class="col-12">
    <mat-card
      class="mat-card-top cardWithShadow position-relative overflow-hidden p-16"
    >
      <!-- output view -->
      <h4 Ctitle>
        Talent match
        <span class="f-s-14 f-w-400 d-block"
          >select one or more candidate to schedule an interview</span
        >
      </h4>

      <div output>
        <div class="d-flex align-items-center gap-2 m-b-16 m-t-16">
          <mat-form-field
            appearance="outline"
            class="flex-grow-1 hide-hint m-b-0"
          >
            <input matInput type="text" placeholder="Search Candidate" />
            <mat-icon matSuffix>
              <i-tabler name="search" class="icon-20 d-flex m-t-2"></i-tabler>
            </mat-icon>
          </mat-form-field>
          <button
            *ngIf="canManage"
            mat-flat-button
            class="m-r-8"
            (click)="openAddCandidateDialog()"
          >
            New candidate
          </button>
        </div>
        <div class="table-responsive">
          <table mat-table [dataSource]="dataSource" class="w-100">
            <!-- Name Column -->
            <ng-container matColumnDef="name">
              <th
                mat-header-cell
                *matHeaderCellDef
                class="f-w-600 f-s-16 col-2"
              >
                Name
              </th>
              <td mat-cell *matCellDef="let element">
                <div class="d-flex align-items-center">
                  <img
                    width="45"
                    height="45"
                    class="rounded-circle"
                    style="object-fit: cover; aspect-ratio: 1 / 1"
                    [src]="
                      element.profile_pic_url
                        ? element.profile_pic_url
                        : assetsPath
                    "
                    alt="Profile picture"
                    (error)="handleImageError($event)"
                  />
                  <div class="m-l-16">
                    <h6 class="f-s-14 f-w-600">
                      {{ element.name }}
                    </h6>
                    <span
                      class="f-s-12 f-w-400 d-block"
                      *ngIf="element.current_position"
                    >
                      {{ element.current_position }}
                    </span>
                  </div>
                </div>
              </td>
            </ng-container>

            <!-- Position Column -->
            <ng-container matColumnDef="position">
              <th
                mat-header-cell
                *matHeaderCellDef
                class="f-w-600 f-s-16 col-1"
              >
                Position
              </th>
              <td mat-cell *matCellDef="let element">
                <p class="f-s-14 f-s-12 m-0">
                  {{ getPositionTitle(element.position_id) }}
                </p>
              </td>
            </ng-container>

            <!-- Alignment Column -->
            <ng-container matColumnDef="alignment">
              <th
                mat-header-cell
                *matHeaderCellDef
                class="f-w-600 f-s-16 col-2"
              >
                Alignment
              </th>
              <td mat-cell *matCellDef="let element">
                <span class="f-w-600"
                  >{{ element.match_percentage || "0" }}%
                </span>
                {{ element.position_category }}
              </td>
            </ng-container>

            <!-- Experience Column -->
            <ng-container matColumnDef="experience">
              <th
                mat-header-cell
                *matHeaderCellDef
                class="f-w-600 f-s-14 col-3"
              >
                Experience
              </th>
              <td mat-cell *matCellDef="let element" class="f-s-14">
                <ng-container *ngIf="element.work_experience">
                  <ng-container
                    *ngIf="
                      !expandedWorkExp[element.id] &&
                      element.work_experience.length > 200
                    "
                  >
                    {{ element.work_experience | slice : 0 : 200 }}...
                    <button
                      mat-button
                      color="primary"
                      class="p-0"
                      (click)="
                        expandedWorkExp[element.id] = true;
                        $event.stopPropagation()
                      "
                    >
                      Read more
                    </button>
                  </ng-container>
                  <ng-container
                    *ngIf="
                      expandedWorkExp[element.id] ||
                      element.work_experience.length <= 200
                    "
                  >
                    {{ element.work_experience }}
                    <button
                      *ngIf="element.work_experience.length > 200"
                      mat-button
                      color="primary"
                      class="p-0"
                      (click)="
                        expandedWorkExp[element.id] = false;
                        $event.stopPropagation()
                      "
                    >
                      Show less
                    </button>
                  </ng-container>
                </ng-container>
              </td>
            </ng-container>

            <ng-container matColumnDef="rate">
              <th
                mat-header-cell
                *matHeaderCellDef
                class="f-w-600 f-s-16 col-1"
              >
                Rate
              </th>
              <td mat-cell *matCellDef="let element">
                <p class="f-s-14 m-0">
                  <span> $3 </span>
                </p>
              </td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
              <th
                mat-header-cell
                *matHeaderCellDef
                class="f-w-600 f-s-16 col-2 status-cell"
              >
                Status
              </th>
              <td mat-cell *matCellDef="let element" class="f-s-14 status-cell">
                <span
                  class="p-x-8 p-y-4 f-w-500 rounded-pill f-s-12 status-pill"
                  [ngStyle]="{
                    'background-color':
                      element.status === 'pending'
                        ? 'var(--mat-sys-error)'
                        : element.status === 'talent match'
                        ? 'rgb(253, 253, 150)'
                        : element.status === 'hired'
                        ? 'var(--mat-sys-primary)'
                        : element.status === 'reviewing'
                        ? 'rgb(255, 174, 105)'
                        : 'rgb(72, 72, 72)',
                    color: element.status === 'talent match' ? 'black' : 'white'
                  }"
                >
                  {{ element.status }}
                </span>
              </td>
            </ng-container>

            <ng-container matColumnDef="interviewing on">
              <th
                mat-header-cell
                *matHeaderCellDef
                class="f-w-600 f-s-16 col-3 text-center"
              >
                Interviewing on
              </th>
              <td mat-cell *matCellDef="let element">
                {{
                  getInterviewDateTime(element.id)
                    ? (getInterviewDateTime(element.id) | date : "short")
                    : "No scheduled"
                }}
              </td>
            </ng-container>

            <!-- Edit Column -->
            <ng-container matColumnDef="actions">
              <th
                mat-header-cell
                *matHeaderCellDef
                class="f-w-600 f-s-16 col-1"
              >
                Actions
              </th>
              <td mat-cell *matCellDef="let element">
                <button mat-icon-button [matMenuTriggerFor]="actionsMenu">
                  <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #actionsMenu="matMenu">
                  <button
                    mat-menu-item
                    (click)="openCandidateResume(element.resume_url)"
                  >
                    <mat-icon>visibility</mat-icon>
                    <span>View</span>
                  </button>
                  <button
                    mat-menu-item
                    (click)="goToCandidate(element.id, $event)"
                    *ngIf="canEdit"
                  >
                    <mat-icon>edit</mat-icon>
                    <span>Edit</span>
                  </button>
                  <button
                    mat-menu-item
                    (click)="deleteCandidate(element.id)"
                    *ngIf="canDelete"
                  >
                    <mat-icon>delete</mat-icon>
                    <span>Delete</span>
                  </button>
                </mat-menu>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr
              mat-row
              *matRowDef="let row; columns: displayedColumns"
              (click)="selection.toggle(row)"
            ></tr>
          </table>
        </div>
      </div>
    </mat-card>
  </div>
</div>
